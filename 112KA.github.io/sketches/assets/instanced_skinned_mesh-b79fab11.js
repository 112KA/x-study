var E=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var s=(i,t,e)=>(E(i,t,"read from private field"),e?e.call(i):t.get(i)),r=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},n=(i,t,e,a)=>(E(i,t,"write to private field"),a?a.call(i,e):t.set(i,e),e);var l=(i,t,e)=>(E(i,t,"access private method"),e);import"./global-db37dd4d.js";import{j as G,P as q,W as U,O as V,k as W,_ as Z,m as $,b as J,s as N,$ as K,Z as Q,a0 as X}from"./vendor-7744dd83.js";import{w as Y,a as ee}from"./x-d4d866bf.js";import{I as O,A as te,a as se}from"./x3-74f69371.js";class ie{constructor({canvas:t}){var a;this.scene=new G,this.camera=new q(45,1,.1,1e4),this.renderer=new U({canvas:t,antialias:!1,alpha:!1}),this.renderer.setClearColor(0,0),this.renderer.setPixelRatio(1),this.camera.position.set(0,5,10),this._cameraControls=new V(this.camera,this.renderer.domElement);const e=[];e[0]=new W(16777215,1,0),e[1]=new W(16777215,1,0),e[2]=new W(16777215,1,0),e[0].position.set(0,200,0),e[1].position.set(100,200,100),e[2].position.set(-100,-200,-100),this.scene.add(...e),this.grid=new Z(40,20),this.scene.add(this.grid),this._stats=new $,(a=document.querySelector("body"))==null||a.appendChild(this._stats.dom)}render(){this._cameraControls.update(),this.renderer.render(this.scene,this.camera),this._stats.update()}resize(){const t=window.innerWidth,e=window.innerHeight;this.renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix()}setDeviceSize(t){console.log({deviceSize:t})}}var u,p,d,h,o,x,c,g,b,_,I,D;class ae{constructor(t,e,a){r(this,b);r(this,I);r(this,u,void 0);r(this,p,void 0);r(this,d,void 0);r(this,h,void 0);r(this,o,void 0);r(this,x,void 0);r(this,c,void 0);r(this,g,void 0);this.instanceIndex=t,n(this,u,!0),this.matrix=new J,n(this,h,{}),n(this,o,""),n(this,c,new N((.5-Math.random())*40,0,(.5-Math.random())*40)),n(this,g,new N(1,1,1)),n(this,p,new K(e)),n(this,d,e),n(this,x,s(this,d).matrix.clone().invert()),s(this,h).idle=s(this,p).clipAction(a[0]),s(this,h).running=s(this,p).clipAction(a[1]),l(this,b,_).call(this)}update(t){s(this,u)&&(s(this,o)==="running"&&(s(this,c).z+=.06,s(this,c).z>20&&(s(this,c).z=-20),l(this,I,D).call(this)),s(this,p).update(t),s(this,d).updateMatrixWorld(),s(this,d).traverse(e=>{e instanceof O&&(e.updateMatrixWorld(),e.skeleton.bones.forEach(a=>{a.updateMatrixWorld()}),e.skeleton.updateAt(this.instanceIndex))}))}executeCrossFade(t,e,a){this.setWeight(e,1),t.crossFadeTo(e,a,!1)}setWeight(t,e){t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(e)}set enabled(t){n(this,u,t);const e=s(this,u)?1:0;s(this,g).setScalar(e),l(this,I,D).call(this)}}u=new WeakMap,p=new WeakMap,d=new WeakMap,h=new WeakMap,o=new WeakMap,x=new WeakMap,c=new WeakMap,g=new WeakMap,b=new WeakSet,_=async function(){switch(s(this,o)){case"":s(this,h).running.play(),s(this,h).idle.play(),s(this,h).idle.setEffectiveWeight(0),n(this,o,"running");break;case"idle":this.executeCrossFade(s(this,h).idle,s(this,h).running,.5),n(this,o,"running");break;case"running":this.executeCrossFade(s(this,h).running,s(this,h).idle,.5),n(this,o,"idle");break}await Y(5e3+5e3*Math.random()),l(this,b,_).call(this)},I=new WeakSet,D=function(){this.matrix.identity(),this.matrix.scale(s(this,g)),this.matrix.setPosition(s(this,c).clone().applyMatrix4(s(this,x))),s(this,d).traverse(t=>{t instanceof O&&(t.setMatrixAt(this.instanceIndex,this.matrix),t.updateMatrix())})};const ne="/sketches/assets/model-b4812744.glb";var m,M,v,k,C,P;class re{constructor({renderer:t,grid:e},a){r(this,C);r(this,m,void 0);r(this,M,void 0);r(this,v,void 0);r(this,k,void 0);n(this,m,new Q.Pane),this.n=100,this.drawcalls="0",n(this,M,t),n(this,v,a),n(this,k,s(this,m).addInput(this,"drawcalls",{disabled:!0})),s(this,m).addInput(this,"n",{min:1,max:300,step:1}).on("change",S=>{l(this,C,P).call(this)}),l(this,C,P).call(this),s(this,m).addInput(e,"visible",{label:"grid"})}update(){this.drawcalls=s(this,M).info.render.calls.toString(),s(this,k).refresh()}}m=new WeakMap,M=new WeakMap,v=new WeakMap,k=new WeakMap,C=new WeakSet,P=function(){s(this,v).forEach((t,e)=>{t.enabled=e<this.n})};const B=document.getElementById("canvas");ee(B);const f=new ie({canvas:B}),z=new te({}),L=300;async function he(){z.addResources([{name:"model",path:ne}]),await z.load();const{scene:i,animations:t}=z.models.model,e=i.getObjectByName("Armature"),a=se.convertToInstancedObject(e,L),S=new X(a);f.scene.add(a),a.updateMatrix(),S.material.linewidth=2,f.scene.add(S);let j=0;const A=[];for(let w=0;w<L;w++)A.push(new ae(w,a,t));const F=new re(f,A);let H=0;f.renderer.setAnimationLoop(w=>{if(H++%2===0)return;const R=(w-j)/1e3;for(let y=0;y<L;y++)A[y].update(R);f.render(),j=w,F.update()}),T(),window.addEventListener("resize",T)}function T(){f.resize()}he();
